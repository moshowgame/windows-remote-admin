<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Windows 11 Êñá‰ª∂ÊµèËßàÂô®</title>
    <link th:href="@{/static/bootstrap/5.3.2/css/bootstrap.min.css}" rel="stylesheet"/>
    <link th:href="@{/static/font-awesome/6.4.0/css/all.min.css}" rel="stylesheet"/>
    <link rel="stylesheet" th:href="@{/static/bootstrap/5.3.2/css/bootstrap-icons.min.css}">
    <style>
        /* È©¨ÈáåÂ••ÂÉèÁ¥†È£éÊ†º‰∏ªÈ¢ò */
        :root {
            --mario-red: #e52521;
            --mario-blue: #3c44aa;
            --mario-green: #4bad4b;
            --mario-yellow: #fbd000;
            --mario-brown: #964b00;
            --mario-skin: #fcb97d;
            --pixel-bg: #6b8cff;
            --pixel-border: #000000;
            --pixel-highlight: #ff0000;
            --pixel-text: #ffffff;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 100%);
            min-height: 100vh;
            padding: 20px 0;
            overflow-x: hidden;
        }

        /* Ë£ÖÈ•∞ÊÄßËÉåÊôØÂÖÉÁ¥† */
        .background-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .mario-block {
            position: absolute;
            width: 40px;
            height: 40px;
            background: var(--mario-red);
            border: 4px solid var(--pixel-border);
            z-index: 1;
        }

        .mario-block.question {
            background: var(--mario-yellow);
            color: var(--pixel-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
        }

        .coin {
            position: absolute;
            width: 20px;
            height: 20px;
            background: var(--mario-yellow);
            border: 2px solid var(--pixel-border);
            border-radius: 50%;
            animation: coinFloat 3s ease-in-out infinite;
        }

        @keyframes coinFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .pipe {
            position: absolute;
            width: 60px;
            background: var(--mario-green);
            border: 4px solid var(--pixel-border);
        }

        .pipe-top {
            height: 30px;
            border-bottom: none;
            border-radius: 30px 30px 0 0;
        }

        .pipe-stem {
            height: 80px;
            border-top: none;
        }

        .cloud {
            position: absolute;
            background: white;
            border: 3px solid var(--pixel-border);
            border-radius: 50%;
        }

        .cloud:before, .cloud:after {
            content: "";
            position: absolute;
            background: white;
            border: 3px solid var(--pixel-border);
            border-radius: 50%;
        }

        /* ‰∏ªÊñá‰ª∂ÁÆ°ÁêÜÂô®ÂÆπÂô® */
        .file-explorer {
            background: var(--pixel-bg);
            border: 6px solid var(--pixel-border);
            box-shadow: 12px 12px 0px rgba(0,0,0,0.3);
            overflow: hidden;
            display: flex;
            height: 80vh;
            position: relative;
        }

        .file-explorer::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: repeating-linear-gradient(
                90deg,
                var(--pixel-highlight),
                var(--pixel-highlight) 15px,
                var(--pixel-bg) 15px,
                var(--pixel-bg) 30px
            );
        }

        /* ‰æßËæπÊ†èÂÉèÁ¥†È£éÊ†º */
        .sidebar {
            width: 280px;
            background: linear-gradient(to bottom, var(--mario-blue), #2980b9);
            border-right: 6px solid var(--pixel-border);
            padding: 20px;
            position: relative;
        }

        .sidebar::after {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            width: 6px;
            height: 100%;
            background: repeating-linear-gradient(
                180deg,
                var(--mario-yellow),
                var(--mario-yellow) 10px,
                transparent 10px,
                transparent 20px
            );
        }

        .quick-access h6 {
            color: var(--pixel-text);
            font-size: 1.2rem;
            margin-bottom: 15px;
            text-shadow: 3px 3px 0px var(--pixel-border);
            border-bottom: 4px solid var(--pixel-border);
            padding-bottom: 8px;
            text-align: center;
            letter-spacing: 2px;
        }

        .nav-link {
            display: block;
            background: var(--mario-red);
            color: var(--pixel-text);
            padding: 12px 16px;
            border: 4px solid var(--pixel-border);
            text-decoration: none;
            margin-bottom: 12px;
            transition: all 0.1s;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.3);
            font-weight: bold;
            text-shadow: 2px 2px 0px var(--pixel-border);
            cursor: pointer;
            position: relative;
            z-index: 10;
        }

        .nav-link:hover {
            background: #c0392b;
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px rgba(0,0,0,0.3);
        }

        .sidebar {
            position: relative;
            z-index: 20;
        }

        .nav-link i {
            margin-right: 10px;
            text-shadow: 2px 2px 0px #000;
        }

        /* Â∑•ÂÖ∑Ê†èÂÉèÁ¥†È£éÊ†º */
        .toolbar {
            background: linear-gradient(to right, var(--mario-green), #27ae60);
            border-bottom: 6px solid var(--pixel-border);
            padding: 12px 16px;
            gap: 12px;
            position: relative;
        }

        .toolbar::before {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: repeating-linear-gradient(
                90deg,
                var(--mario-yellow),
                var(--mario-yellow) 12px,
                transparent 12px,
                transparent 24px
            );
        }

        .btn {
            background: linear-gradient(to bottom, var(--mario-red), #c0392b);
            color: var(--pixel-text);
            border: 3px solid var(--pixel-border);
            border-radius: 0;
            padding: 8px 12px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.3);
            transition: all 0.1s;
        }

        .btn:hover {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0px rgba(0,0,0,0.3);
            background: linear-gradient(to bottom, #c0392b, #a5281e);
        }

        .btn:active {
            transform: translate(4px, 4px);
            box-shadow: 0px 0px 0px rgba(0,0,0,0.3);
        }

        .btn-light {
            background: linear-gradient(to bottom, #f1c40f, #f39c12);
            color: var(--pixel-border);
        }

        .search-box, .path-input {
            background: var(--mario-yellow);
            color: var(--pixel-border);
            border: 4px solid var(--pixel-border);
            border-radius: 0;
            padding: 8px 16px;
            font-weight: bold;
            box-shadow: inset 3px 3px 0px rgba(0,0,0,0.3);
            font-family: 'Courier New', monospace;
        }

        .search-box:focus, .path-input:focus {
            outline: none;
            box-shadow: inset 3px 3px 0px rgba(0,0,0,0.3), 0 0 0 0.25rem rgba(241, 196, 15, 0.25);
            border-color: var(--mario-red);
        }

        /* Êñá‰ª∂ÂàóË°®ÂÉèÁ¥†È£éÊ†º */
        .file-list {
            background: #0a1a2f;
            flex-grow: 1;
            overflow-y: auto;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 10px;
        }

        .file-item {
            display: grid;
            grid-template-columns: 40px 3fr 1fr 120px 120px 150px;
            align-items: center;
            padding: 12px 16px;
            border: 3px solid transparent;
            transition: all 0.1s;
            cursor: default;
            margin-bottom: 5px;
            background: rgba(0, 50, 100, 0.3);
        }

        .file-item:hover {
            border-color: var(--mario-yellow);
            background: rgba(251, 208, 0, 0.2);
            transform: translate(2px, 2px);
        }

        .file-item.text-muted {
            background: rgba(100, 100, 100, 0.5);
            color: #aaaaaa;
            border-bottom: 4px solid var(--pixel-border);
        }

        .file-item i {
            text-shadow: 2px 2px 0px var(--pixel-border);
        }

        /* Êìç‰ΩúÊåâÈíÆÁªÑ */
        .btn-group .btn {
            margin-right: 5px;
        }

        .btn-primary {
            background: linear-gradient(to bottom, var(--mario-blue), #2980b9);
        }

        .btn-secondary {
            background: linear-gradient(to bottom, #95a5a6, #7f8c8d);
        }

        .btn-success {
            background: linear-gradient(to bottom, var(--mario-green), #27ae60);
        }

        .btn-info {
            background: linear-gradient(to bottom, #3498db, #2980b9);
        }

        .btn-warning {
            background: linear-gradient(to bottom, var(--mario-yellow), #f39c12);
            color: var(--pixel-border);
        }

        /* Áä∂ÊÄÅÊ†èÂÉèÁ¥†È£éÊ†º */
        .status-bar {
            background: linear-gradient(to right, var(--mario-red), #c0392b);
            border-top: 6px solid var(--pixel-border);
            padding: 12px 16px;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
            color: var(--pixel-text);
            font-weight: bold;
            text-shadow: 2px 2px 0px var(--pixel-border);
        }

        .status-bar a {
            color: var(--mario-yellow);
            text-decoration: none;
        }

        .status-bar a:hover {
            color: white;
            text-decoration: underline;
        }

        /* Êñá‰ª∂ÂÜÖÂÆπÂå∫Âüü */
        .file-content {
            display: none;
            background: #0a1a2f;
            padding: 20px;
            border-top: 6px solid var(--pixel-border);
            flex-grow: 1;
            overflow-y: auto;
            color: #00ff00;
            font-family: 'Courier New', monospace;
        }

        .alert {
            border: 4px solid var(--pixel-border);
            border-radius: 0;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }

        .alert-success {
            background: linear-gradient(to bottom, var(--mario-green), #27ae60);
            color: var(--pixel-text);
            border-color: var(--pixel-border);
        }

        .alert-danger {
            background: linear-gradient(to bottom, var(--mario-red), #c0392b);
            color: var(--pixel-text);
            border-color: var(--pixel-border);
        }

        pre {
            color: inherit;
            background: transparent;
            border: none;
            padding: 0;
            margin: 0;
            white-space: pre-wrap;
            word-break: break-word;
            font-family: 'Courier New', monospace;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 6px solid var(--pixel-border);
            }
            
            .d-flex {
                flex-direction: column;
            }
            
            .file-item {
                grid-template-columns: 40px 2fr 1fr 100px;
            }
        }

        /* Êâ´ÊèèÁ∫øÊïàÊûú */
        .scanline {
            position: relative;
            overflow: hidden;
        }

        .scanline::after {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(transparent 50%, rgba(0,255,0,0.1) 50%);
            background-size: 100% 6px;
            pointer-events: none;
            animation: scan 8s linear infinite;
        }

        @keyframes scan {
            0% { transform: translateY(0); }
            100% { transform: translateY(100%); }
        }
    </style>
</head>
<body>
    <div class="container-lg mt-4">
        <div class="file-explorer">
            <!-- ‰æßËæπÊ†è -->
            <div class="sidebar">
                <div class="quick-access">
                    <h6>üéÆ Âø´ÈÄüËÆøÈóÆ</h6>
                    <div class="nav flex-column">
                        <a class="nav-link" href="#" data-path="C:\\">
                            <i class="fas fa-hdd me-2"></i>Á°¨Áõò C:
                        </a>
                        <a class="nav-link" href="#" data-path="D:\\">
                            <i class="fas fa-hdd me-2"></i>Á°¨Áõò D:
                        </a>
                        <a class="nav-link" href="#" data-path="E:\\">
                            <i class="fas fa-hdd me-2"></i>Á°¨Áõò E:
                        </a>
                        <a class="nav-link" href="#" data-path="C:\\ProgramData\\Qlik\\Sense\\Log\\Repository">
                            <i class="fas fa-book me-2"></i>QlikÂ≠òÂÇ®Â∫ìÊó•Âøó
                        </a>
                        <a class="nav-link" href="#" data-path="C:\\ProgramData\\Qlik\\Sense\\Log\\Script">
                            <i class="fas fa-scroll me-2"></i>QlikËÑöÊú¨Êó•Âøó
                        </a>
                        <a class="nav-link" href="#" data-path="D:\\QlikShare\\ArchivedLogs">
                            <i class="fas fa-archive me-2"></i>QlikÂΩíÊ°£Êó•Âøó
                        </a>
                        <a class="nav-link" href="#" data-path="D:\\DataShare">
                            <i class="fas fa-database me-2"></i>Êï∞ÊçÆÂÖ±‰∫´Âå∫
                        </a>
                        <a class="nav-link" href="#" data-path="C:\\Windows\\System32">
                            <i class="fas fa-cogs me-2"></i>Á≥ªÁªüÊñá‰ª∂
                        </a>
                        <a class="nav-link" href="#" data-path="C:\\Users">
                            <i class="fas fa-users me-2"></i>Áî®Êà∑ÁõÆÂΩï
                        </a>
                    </div>
                </div>
            </div>

            <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
            <div class="flex-grow-1 d-flex flex-column">
                <!-- Â∑•ÂÖ∑Ê†è -->
                <div class="toolbar d-flex flex-column">
                    <div class="d-flex align-items-center mb-3">
                        <div class="btn-group me-2">
                            <button class="btn btn-sm btn-light" id="btnBack" title="ËøîÂõû">
                                <i class="fas fa-arrow-left"></i>
                            </button>
                            <button class="btn btn-sm btn-light" id="btnForward" title="ÂâçËøõ">
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                        <button class="btn btn-sm btn-light me-2" id="btnUp" title="‰∏äÁ∫ßÁõÆÂΩï">
                            <i class="fas fa-arrow-up"></i>
                        </button>
                        <button class="btn btn-sm btn-light me-2" id="btnClear" title="Ê∏ÖÈô§ÂÜÖÂÆπ">
                            <i class="bi bi-journal-x"></i>
                        </button>
                        <div class="position-relative me-2">
                            <i class="fas fa-map-marker-alt" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--pixel-border); text-shadow: 1px 1px 0px white;"></i>
                            <input type="text" class="path-input mb-0 flex-grow-1 ps-4" placeholder="ËæìÂÖ•Êñá‰ª∂Ë∑ØÂæÑ">
                        </div>
                        <div class="position-relative">
                            <i class="fas fa-search" style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--pixel-border); text-shadow: 1px 1px 0px white;"></i>
                            <input type="text" class="search-box mb-0 flex-grow-1 ps-4" placeholder="ÊêúÁ¥¢Êñá‰ª∂">
                        </div>
                    </div>
                </div>

                <!-- Êñá‰ª∂ÂàóË°® -->
                <div class="file-list" id="fileList">
                    <div class="file-item text-muted fw-bold">
                        <div></div>
                        <div>ÂêçÁß∞</div>
                        <div>Á±ªÂûã</div>
                        <div>‰øÆÊîπÊó•Êúü</div>
                        <div>Â§ßÂ∞è</div>
                        <div>Êìç‰Ωú</div>
                    </div>
                </div>


                <!-- Áä∂ÊÄÅÊ†è -->
                <div class="status-bar">
                    <span><i class="fas fa-coins"></i> Êñá‰ª∂Êï∞Èáè: <span id="fileCount">0</span></span>
                    <span>
                        <i class="fas fa-folder-open" title="ËøõÂÖ•Êñá‰ª∂Â§π"></i>
                        <i class="fas fa-book ms-2" title="Êó•ÂøóÊü•ÁúãÂô®"></i>
                        <i class="fas fa-file-code ms-2" title="Êü•ÁúãÂÜÖÂÆπ"></i>
                        <i class="fas fa-download ms-2" title="‰∏ãËΩΩÊñá‰ª∂"></i>
                        <i class="fas fa-eye ms-2" title="ÊñáÊú¨Êü•ÁúãÂô®"></i>
                    </span>
                    <span>
                        <i class="fas fa-gamepad"></i>
                        <a href="https://github.com/moshowgame/SpringBootRemotePowershellAdmin" target="_blank">SREÊñá‰ª∂ÁÆ°ÁêÜÂô®</a>
                        <i class="fas fa-heart" style="color: var(--mario-red);"></i>
                        <a href="https://zhengkai.blog.csdn.net/" target="_blank">by Moshow</a>
                    </span>
                </div>
            </div>
        </div>
        <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
        <div class="flex-grow-1 d-flex flex-column">
            <!-- Êñá‰ª∂ÂÜÖÂÆπ -->
            <div class="file-content" id="fileContent"></div>
        </div>
    </div>

    <script th:src="@{/static/jquery/3.7.1/jquery.min.js}"></script>
    <script th:src="@{/static/bootstrap/5.3.2/js/bootstrap.bundle.min.js}"></script>

    <script th:inline="javascript">
        const listUrl = /*[[ @{/list} ]]*/ '';
        const logViewerUrl = /*[[ @{/logViewer} ]]*/ '';
        const vscodeUrl = /*[[ @{/textViewer} ]]*/ '';
        const readUrl = /*[[ @{/read} ]]*/ '';
        const downloadUrl = /*[[ @{/download} ]]*/ '';
        const normalizedPath = /*[[ @{/normalizedPath} ]]*/ '';
        // ÂõæÊ†áÊò†Â∞Ñ
        const iconMap = {
            true: 'fa-folder',
            'Êñá‰ª∂Â§π': 'fa-folder',
            folder: 'fa-folder',
            'file-word': 'fa-file-word',
            'file-exe': 'fa-file-code',
            link: 'fa-link',
            default: 'fa-file'
        };

        let currentPath = 'C:\\';
        let history = [];
        let currentHistoryIndex = -1;
        // Êñ∞Â¢ûÊñá‰ª∂Á≥ªÁªüÂØπË±°‰ª•‰øùÂ≠òË∑ØÂæÑÂØπÂ∫îÁöÑÊñá‰ª∂ÂàóË°®
        const fileSystem = {};

        // ÂàùÂßãÂåñ
        $(document).ready(() => {
            console.log('ÊñáÊ°£Âä†ËΩΩÂÆåÊàê');
            loadPath(currentPath);

            // Âø´ÈÄüËÆøÈóÆÁÇπÂáª - ‰ΩøÁî®‰∫ã‰ª∂ÂßîÊâòÁ°Æ‰øùÂä®ÊÄÅÂÖÉÁ¥†‰πüËÉΩÂìçÂ∫î
            $(document).on('click', '.nav-link[data-path]', function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log('Âø´ÈÄüËÆøÈóÆÁÇπÂáª:', $(this).data('path'));
                console.log('ÁÇπÂáªÂÖÉÁ¥†:', this);
                loadPath($(this).data('path'));
            });

            // Ë∞ÉËØïÔºöÊ£ÄÊü•Âø´ÈÄüËÆøÈóÆÈìæÊé•ÊòØÂê¶Â≠òÂú®
            console.log('Âø´ÈÄüËÆøÈóÆÈìæÊé•Êï∞Èáè:', $('.nav-link[data-path]').length);
            $('.nav-link[data-path]').each(function(index) {
                console.log(`ÈìæÊé•${index}:`, $(this).data('path'));
            });

            // ËøîÂõû‰∏äÁ∫ßÁõÆÂΩï
            $('#btnUp').click(() => {
                const parentPath = getParentPath(currentPath);
                if (parentPath) loadPath(parentPath);
            });

            // ÂØºËà™ÊåâÈíÆ
            $('#btnBack').click(() => navigateHistory(-1));
            $('#btnForward').click(() => navigateHistory(1));

            // ÊêúÁ¥¢ÂäüËÉΩ
            $('.search-box').on('input', function() {
                const keyword = $(this).val().toLowerCase();
                filterFiles(keyword);
            });

            // Êñá‰ª∂ÁÇπÂáª‰∫ã‰ª∂
            $('#fileList').on('click', '.file-item', function() {
                const fileName = $(this).find('div:nth-child(2)').text();
                const filePath = currentPath +"//"+ fileName;
                if ($(this).find('div:nth-child(1)').html() === '<i class="fas fa-folder text-primary"></i>') {
                    loadPath(filePath);
                } else {
                    readFile(filePath);
                }
                console.log($(this).find('div:nth-child(1)').html(),filePath);
            });

            // ËøõÂÖ•Êñá‰ª∂Â§π
            $('#fileList').on('click', '.enter-btn', function(e) {
                e.stopPropagation();
                const path = $(this).data('path');
                loadPath(path);
            });

            // ËØªÂèñÊñá‰ª∂
            $('#fileList').on('click', '.read-btn', function(e) {
                e.stopPropagation();
                const path = $(this).data('path');
                readFile(path);
            });

            // ‰∏ãËΩΩÊñá‰ª∂
            $('#fileList').on('click', '.download-btn', function(e) {
                e.stopPropagation();
                const path = $(this).data('path');
                downloadFile(path);
            });

            // Êü•ÁúãÊñá‰ª∂
            $('#fileList').on('click', '.view-btn', function(e) {
                e.stopPropagation();
                const path = $(this).data('path');
                window.open(vscodeUrl+'?filePath=' + encodeURIComponent(path), '_blank');
            });

            // ÊâìÂºÄÊó•ÂøóÊü•ÁúãÂô®
            $('#fileList').on('click', '.log-viewer-btn', function(e) {
                e.stopPropagation();
                const path = $(this).data('path');
                window.open(logViewerUrl+'?filePath=' + encodeURIComponent(path), '_blank');
            });

            // Ê∏ÖÈô§Êó•ÂøóÂÜÖÂÆπ
            $('#btnClear').click(() => {
                $('#fileContent').empty().hide();
            });

            // Êñ∞Â¢ûÂú∞ÂùÄÊ†èÂõûËΩ¶‰∫ã‰ª∂  
            $('.path-input').on('keydown', function(e) {  
                if (e.key === 'Enter') {  
                    const path = $(this).val().trim();  
                    if (path) {  
                        loadPath(path);  
                    }  
                }  
            });  
        });

        // Âä†ËΩΩË∑ØÂæÑ
        function loadPath(path, fromHistory = false) {
            if (!fromHistory) {
                history = history.slice(0, currentHistoryIndex + 1);
                history.push(path);
                currentHistoryIndex++;
            }

            currentPath = path;

            // ËØ∑Ê±ÇÂêéÁ´ØÊé•Âè£ÈáçÊñ∞Ê†ºÂºèÂåñË∑ØÂæÑ
            $.ajax({
                url: /*[[ @{/normalizedPath} ]]*/ '',
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({ filePath: path }),
                success: function(response) {
                    const normalizedPath = response.data;
                    currentPath = normalizedPath;
                    fetchFiles(normalizedPath);
                    updateNavigationButtons();
                    $('#fileContent').hide();
                    $('.path-input').val(normalizedPath);
                },
                error: function(xhr, status, error) {
                    console.error('Ë∑ØÂæÑÊ†ºÂºèÂåñÂ§±Ë¥•:', error);
                    fetchFiles(path);
                    updateNavigationButtons();
                    $('#fileContent').hide();
                    $('.path-input').val(path);
                }
            });
        }

        // Ëé∑ÂèñÊñá‰ª∂ÂàóË°®
        function fetchFiles(path) {
            $.ajax({
                url: listUrl,
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({ filePath: path }),
                success: function(response) {
                    // ‰øùÂ≠òÊñá‰ª∂ÂàóË°®Âà∞ fileSystem ÂØπË±°
                    fileSystem[path] = response.data;
                    renderFiles(response.data);
                },
                error: function(xhr, status, error) {
                    $('#fileList').empty().append('<div class="text-danger">Âä†ËΩΩÊñá‰ª∂Â§±Ë¥•: Access Denied Exception or other IO Exception</div>');
                }
            });
        }

        // Ê∏≤ÊüìÊñá‰ª∂ÂàóË°®
        function renderFiles(files) {
            const $list = $('#fileList').empty().append(
                '<div class="file-item text-muted fw-bold">' +
                '<div>ÂêçÁß∞</div><div>Á±ªÂûã</div><div>‰øÆÊîπÊó•Êúü</div><div>Â§ßÂ∞è</div><div>Êìç‰Ωú</div></div>'
            );

            files.forEach(file => {
                const fileType = file.directory ? 'Êñá‰ª∂Â§π' : 'Êñá‰ª∂';
                const icon = iconMap[fileType] || iconMap.default;
                const actionButton = file.directory
                    ? `<button class="btn btn-sm btn-primary enter-btn" data-path="${currentPath}\\${file.name}"><i class="bi bi-folder2-open"></i></button>
                       <button class="btn btn-sm btn-secondary log-viewer-btn" data-path="${currentPath}\\${file.name}"><i class="bi bi-journal-text"></i></button>`
                    : `<button class="btn btn-sm btn-success read-btn" data-path="${currentPath}\\${file.name}"><i class="bi bi-code-square"></i></button>
                       <button class="btn btn-sm btn-info download-btn" data-path="${currentPath}\\${file.name}"><i class="bi bi-file-earmark-arrow-down"></i></button>
                       <button class="btn btn-sm btn-warning view-btn" data-path="${currentPath}\\${file.name}"><i class="bi bi-eye"></i></button>`;
                // ËÆ°ÁÆóÊñá‰ª∂Â§ßÂ∞è
                let fileSize = file.size;
                let sizeText;
                if(file.directory) {
                    sizeText='-'
                }else{
                    if (fileSize >= 1024 * 1024 * 1024) {
                        sizeText = (fileSize / (1024 * 1024 * 1024)).toFixed(2) + ' GB';
                    } else if (fileSize >= 1024 * 1024) {
                        sizeText = (fileSize / (1024 * 1024)).toFixed(2) + ' MB';
                    } else if (fileSize >= 1024) {
                        sizeText = (fileSize / 1024).toFixed(2) + ' KB';
                    } else {
                        sizeText = fileSize + ' B';
                    }
                }
                $list.append(`
                    <div class="file-item">
                        <div><i class="fas ${icon} text-primary"></i></div>
                        <div>${file.name}</div>
                        <div>${file.lastModified}</div>
                        <div>${sizeText}</div>
                        <div>${actionButton}</div>
                    </div>
                `);
            });

            // Êõ¥Êñ∞Áä∂ÊÄÅÊ†è
            $('#fileCount').text(files.length);
            $('.status-bar span:first').html(`<i class="fas fa-coins"></i> Êñá‰ª∂Êï∞Èáè: ${files.length}`);
        }

        // ÊêúÁ¥¢ËøáÊª§
        function filterFiles(keyword) {
            // ‰ªé fileSystem ÂØπË±°‰∏≠Ëé∑ÂèñÊñá‰ª∂ÂàóË°®
            const files = fileSystem[currentPath] || [];
            const filtered = files.filter(file =>
                file.name.toLowerCase().includes(keyword)
            );
            renderFiles(filtered);
        }

        // ÂØºËà™ÂéÜÂè≤ÊéßÂà∂
        function navigateHistory(direction) {
            const newIndex = currentHistoryIndex + direction;
            if (newIndex >= 0 && newIndex < history.length) {
                currentHistoryIndex = newIndex;
                loadPath(history[currentHistoryIndex], true);
            }
        }

        // Ëé∑Âèñ‰∏äÁ∫ßË∑ØÂæÑ
        function getParentPath(path) {
            const parts = path.split('\\').filter(p => p);
            if (parts.length <= 1) return null;
            return parts.slice(0, -1).join('\\') + '\\';
        }

        // Êõ¥Êñ∞Èù¢ÂåÖÂ±ëÂØºËà™
        function updateBreadcrumb() {
            const parts = currentPath.split('\\').filter(p => p);
            const $breadcrumb = $('.breadcrumb').empty();

            parts.forEach((part, index) => {
                const isLast = index === parts.length - 1;
                const path = parts.slice(0, index + 1).join('\\') + '\\';
                $breadcrumb.append(
                    $(`<a class="breadcrumb-item ${isLast ? 'active' : ''}">${part}</a>`)
                        .click(!isLast ? () => loadPath(path) : null)
                );
            });
        }

        // Êõ¥Êñ∞ÂØºËà™ÊåâÈíÆÁä∂ÊÄÅ
        function updateNavigationButtons() {
            $('#btnBack').prop('disabled', currentHistoryIndex <= 0);
            $('#btnForward').prop('disabled', currentHistoryIndex >= history.length - 1);
            $('#btnUp').prop('disabled', !getParentPath(currentPath));
        }

        // ËØªÂèñÊñá‰ª∂ÂÜÖÂÆπ
        function readFile(filePath) {
            $.ajax({
                url: readUrl,
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({ filePath: filePath }),
                success: function(response) {
                    console.log(response);
                    $('#fileContent').html('<div class="alert alert-success" role="alert"><pre>' + response.data + '</pre></div>').show();
                },
                error: function(error) {
                    console.log(error);
                    $('#fileContent').html('<div class="alert alert-danger" role="alert"><i class="bi bi-bug-fill"></i><pre>'+error.responseJSON.code+' - '+error.responseJSON.msg+'</pre></div>').show();
                }
            });
        }
        // ‰∏ãËΩΩÊñá‰ª∂ÂÜÖÂÆπ
        function downloadFile(filePath) {
            $.ajax({
                url: downloadUrl,
                type: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({ filePath: filePath }),
                success: function(response) {
                    // ÂàõÂª∫‰∏Ä‰∏™ÈöêËóèÁöÑ<a>Ê†áÁ≠æÔºåÁî®‰∫éËß¶Âèë‰∏ãËΩΩ
                    const blob = new Blob([response], { type: 'application/octet-stream' });
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filePath.split('\\').pop(); // ‰ΩøÁî®Êñá‰ª∂Âêç‰Ωú‰∏∫‰∏ãËΩΩÊñá‰ª∂ÁöÑÈªòËÆ§ÂêçÁß∞
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    $('#fileContent').html('<div class="alert alert-success" role="alert"><i class="bi bi-cloud-arrow-down-fill"></i><pre>‰∏ãËΩΩÊàêÂäü!!!</pre></div>').show();
                },
                error: function(error) {
                    console.log(error);
                    $('#fileContent').html('<div class="alert alert-danger" role="alert"><i class="bi bi-bug-fill"></i><pre>'+error.responseJSON.code+' - '+error.responseJSON.msg+'</pre></div>').show();
                }
            });
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>登录页面</title>
    <!-- Vue 3 CDN -->
    <script src="https://cdn.bootcdn.net/ajax/libs/vue/3.4.0/vue.global.prod.min.js"></script>
    <!-- Naive UI CDN -->
    <script src="https://cdn.bootcdn.net/ajax/libs/naive-ui/2.43.1/index.prod.js"></script>
</head>
<body>
    <div id="app"></div>

    <script type="module">
        const { createApp, ref } = Vue;
        const { NConfigProvider, NCard, NForm, NFormItem, NInput, NButton, NMessageProvider, createDiscreteApi } = naive;

        const App = {
            setup() {
                const formRef = ref(null);
                const formValue = ref({
                    token: '',
                    userName: '',
                    ticketNumber: ''
                });
                const loading = ref(false);

                const entitlementUrl = '/sre/entitlement';
                const landingUrl = '/sre/landing';

                const { message } = createDiscreteApi(['message']);

                const handleLogin = () => {
                    if (!formValue.value.token || !formValue.value.userName || !formValue.value.ticketNumber) {
                        message.error('所有字段都不能为空');
                        return;
                    }

                    loading.value = true;

                    fetch(entitlementUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formValue.value)
                    })
                    .then(response => {
                        if (response.ok) {
                            message.success('登录成功');
                            window.location.href = landingUrl;
                        } else {
                            throw new Error('登录失败');
                        }
                    })
                    .catch(error => {
                        message.error('登录失败，请稍后再试');
                    })
                    .finally(() => {
                        loading.value = false;
                    });
                };

                return {
                    formRef,
                    formValue,
                    loading,
                    handleLogin
                };
            },
            template: `
                <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #f0f0f0; margin: 0;">
                    <n-config-provider>
                        <n-card title="登录" style="width: 400px; text-align: center; border-radius: 10px; box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);">
                            <n-form ref="formRef" :model="formValue" label-placement="left" label-width="100">
                                <n-form-item label="Token" path="token">
                                    <n-input v-model:value="formValue.token" type="password" placeholder="请输入访问Token" @keydown.enter="handleLogin" />
                                </n-form-item>
                                <n-form-item label="用户名" path="userName">
                                    <n-input v-model:value="formValue.userName" placeholder="请输入你的名字" @keydown.enter="handleLogin" />
                                </n-form-item>
                                <n-form-item label="使用目的" path="ticketNumber">
                                    <n-input v-model:value="formValue.ticketNumber" placeholder="请输入本次使用的Purpose/Reason/Ticket" @keydown.enter="handleLogin" />
                                </n-form-item>
                            </n-form>
                            <n-button type="primary" block :loading="loading" @click="handleLogin">登录</n-button>
                        </n-card>
                    </n-config-provider>
                </div>
            `
        };

        createApp(App).use(naive).mount('#app');
    </script>
</body>
</html>
